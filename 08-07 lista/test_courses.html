<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Cadastro de Cursos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .error {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            color: #2e7d32;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
        }
        button {
            background: #1976d2;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1565c0;
        }
        .log {
            background: #333;
            color: #fff;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste de Sistema de Cadastro de Cursos</h1>
    
    <div class="test-section">
        <h2>1. Teste de Inicializa√ß√£o</h2>
        <button onclick="testInitialization()">Testar Inicializa√ß√£o</button>
        <div id="initResult"></div>
    </div>

    <div class="test-section">
        <h2>2. Teste de Login</h2>
        <button onclick="testLogin()">Fazer Login como Admin</button>
        <div id="loginResult"></div>
    </div>

    <div class="test-section">
        <h2>3. Teste de Cadastro de Curso</h2>
        <button onclick="testCourseRegistration()">Cadastrar Curso de Teste</button>
        <div id="courseResult"></div>
    </div>

    <div class="test-section">
        <h2>4. Verificar Dados</h2>
        <button onclick="checkData()">Verificar Dados no LocalStorage</button>
        <div id="dataResult"></div>
    </div>

    <div class="test-section">
        <h2>5. Console Log</h2>
        <div id="consoleLog" class="log"></div>
    </div>

    <script src="main.js"></script>
    <script>
        // Interceptar console.log para mostrar na p√°gina
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const logDiv = document.getElementById('consoleLog');
            logDiv.innerHTML += args.join(' ') + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        };

        function showResult(elementId, message, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="${isSuccess ? 'success' : 'error'}">${message}</div>`;
        }

        function testInitialization() {
            console.log("üß™ Testando inicializa√ß√£o...");
            
            try {
                // Verificar se DataManager foi inicializado
                if (typeof window.dataManager === 'undefined') {
                    throw new Error("DataManager n√£o foi inicializado");
                }

                // Verificar se as vari√°veis globais existem
                if (!window.users || !window.units || !window.courses) {
                    throw new Error("Vari√°veis globais n√£o foram inicializadas");
                }

                // Verificar se h√° dados iniciais
                const coursesCount = window.courses.length;
                const unitsCount = window.units.length;
                const usersCount = window.users.length;

                showResult('initResult', `‚úÖ Inicializa√ß√£o OK!<br>
                    Usu√°rios: ${usersCount}<br>
                    Unidades: ${unitsCount}<br>
                    Cursos: ${coursesCount}`);
                
                console.log("‚úÖ Inicializa√ß√£o testada com sucesso");
                
            } catch (error) {
                showResult('initResult', `‚ùå Erro na inicializa√ß√£o: ${error.message}`, false);
                console.error("‚ùå Erro na inicializa√ß√£o:", error);
            }
        }

        function testLogin() {
            console.log("üß™ Testando login...");
            
            try {
                // Simular login como admin
                const adminUser = window.users.find(u => u.email === 'admin@ios.org.br');
                
                if (!adminUser) {
                    throw new Error("Usu√°rio admin n√£o encontrado");
                }

                // Definir como usu√°rio atual
                window.currentUser = adminUser;
                
                showResult('loginResult', `‚úÖ Login OK!<br>
                    Usu√°rio: ${adminUser.name}<br>
                    Tipo: ${adminUser.type}<br>
                    Email: ${adminUser.email}`);
                
                console.log("‚úÖ Login testado com sucesso");
                
            } catch (error) {
                showResult('loginResult', `‚ùå Erro no login: ${error.message}`, false);
                console.error("‚ùå Erro no login:", error);
            }
        }

        function testCourseRegistration() {
            console.log("üß™ Testando cadastro de curso...");
            
            try {
                // Verificar se h√° usu√°rio logado
                if (!window.currentUser) {
                    throw new Error("Usu√°rio n√£o est√° logado");
                }

                // Sincronizar vari√°veis
                if (typeof window.syncGlobalVariables === 'function') {
                    window.syncGlobalVariables();
                }

                // Verificar se h√° unidades dispon√≠veis
                if (!window.units || window.units.length === 0) {
                    throw new Error("Nenhuma unidade dispon√≠vel");
                }

                // Criar um curso de teste
                const testCourse = {
                    id: Date.now(),
                    name: "Curso de Teste " + Date.now(),
                    description: "Descri√ß√£o do curso de teste",
                    duration: 40,
                    unitId: window.units[0].id,
                    status: "active",
                    createdAt: new Date().toISOString(),
                };

                // Adicionar curso ao array
                window.courses.push(testCourse);
                
                // Salvar dados
                if (typeof window.saveData === 'function') {
                    window.saveData();
                }

                showResult('courseResult', `‚úÖ Curso cadastrado!<br>
                    Nome: ${testCourse.name}<br>
                    Dura√ß√£o: ${testCourse.duration}h<br>
                    Unidade: ${window.units[0].name}<br>
                    Total de cursos: ${window.courses.length}`);
                
                console.log("‚úÖ Curso cadastrado com sucesso");
                
            } catch (error) {
                showResult('courseResult', `‚ùå Erro no cadastro: ${error.message}`, false);
                console.error("‚ùå Erro no cadastro:", error);
            }
        }

        function checkData() {
            console.log("üß™ Verificando dados...");
            
            try {
                // Verificar localStorage
                const stored = localStorage.getItem('ios_attendance_system');
                if (!stored) {
                    throw new Error("Nenhum dado no localStorage");
                }

                const data = JSON.parse(stored);
                
                const html = `
                    <strong>Dados no LocalStorage:</strong><br>
                    Usu√°rios: ${data.users?.length || 0}<br>
                    Unidades: ${data.units?.length || 0}<br>
                    Cursos: ${data.courses?.length || 0}<br>
                    Turmas: ${data.classes?.length || 0}<br>
                    Estudantes: ${data.students?.length || 0}<br>
                    <br>
                    <strong>Dados em Mem√≥ria:</strong><br>
                    Usu√°rios: ${window.users?.length || 0}<br>
                    Unidades: ${window.units?.length || 0}<br>
                    Cursos: ${window.courses?.length || 0}<br>
                    Turmas: ${window.classes?.length || 0}<br>
                    Estudantes: ${window.students?.length || 0}
                `;
                
                showResult('dataResult', html);
                console.log("‚úÖ Dados verificados");
                
            } catch (error) {
                showResult('dataResult', `‚ùå Erro ao verificar dados: ${error.message}`, false);
                console.error("‚ùå Erro ao verificar dados:", error);
            }
        }

        // Executar teste de inicializa√ß√£o automaticamente
        setTimeout(() => {
            testInitialization();
        }, 1000);
    </script>
</body>
</html>
